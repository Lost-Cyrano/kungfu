<!DOCTYPE html>
<html>
<head>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { display: flex; gap: 20px; }
        .panel { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); flex: 1; }
        textarea { width: 100%; height: 300px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 14px; }
        button { margin-top: 10px; padding: 10px 20px; background: #4285f4; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #3367d6; }
        .data { font-family: monospace; white-space: pre-wrap; background: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 10px; max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <div class="panel">
            <textarea id="inputData">CORDA Gohan Duilian

GAVRILOVIC Nino Masculin
LAURENS Koleen Masculin</textarea>
            <button onclick="processAndSend()">Envoyer vers Firebase</button>
            <button onclick="loadData()" style="background: #34a853;">Charger Firebase</button>
            <button onclick="clearData()" style="background: #ea4335;">Effacer Firebase</button>
        </div>
        <div class="panel">
            <div class="data" id="outputData">Donn√©es Firebase...</div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = {
            databaseURL: "https://kungfusete-default-rtdb.europe-west1.firebasedatabase.app/"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        function processAndSend() {
            const input = document.getElementById('inputData').value;
            const lines = input.split('\n');
            let result = {};
            let currentCat = null;
            let catIndex = 1;

            lines.forEach(line => {
                line = line.trim();
                if (line === '') {
                    if (currentCat && currentCat.length > 0) {
                        result[`cat${catIndex}`] = currentCat;
                        catIndex++;
                    }
                    currentCat = [];
                } else if (currentCat !== null) {
                    currentCat.push(line);
                } else {
                    currentCat = [line];
                }
            });

            if (currentCat && currentCat.length > 0) {
                result[`cat${catIndex}`] = currentCat;
            }

            const formattedResult = {};
            Object.keys(result).forEach(catKey => {
                const athletes = result[catKey];
                const catData = {};
                athletes.forEach((athlete, idx) => {
                    catData[`nomAthlete${idx + 1}`] = athlete;
                });
                formattedResult[catKey] = catData;
            });

            database.ref('/').set(formattedResult)
                .then(() => {
                    loadData();
                })
                .catch(error => {
                    console.error(error);
                });
        }

        function loadData() {
            database.ref('/').once('value')
                .then(snapshot => {
                    const data = snapshot.val();
                    document.getElementById('outputData').textContent = JSON.stringify(data, null, 2);
                })
                .catch(error => {
                    console.error(error);
                });
        }

        function clearData() {
            if (confirm('Tout supprimer ?')) {
                database.ref('/').remove()
                    .then(() => {
                        document.getElementById('outputData').textContent = '{}';
                    })
                    .catch(error => {
                        console.error(error);
                    });
            }
        }

        loadData();
    </script>
</body>
</html>
